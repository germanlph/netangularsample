angular.module("homeIndex",["ngRoute"]).config(["$routeProvider","$locationProvider",function(n,t){t.hashPrefix("");n.when("/",{controller:"topicsController",templateUrl:"/templates/topicsView.html"});n.when("/newmessage",{controller:"newTopicController",templateUrl:"/templates/newTopicView.html"});n.when("/message/:id",{controller:"singleTopicController",templateUrl:"/templates/singleTopicView.html"});n.otherwise({redirectTo:"/"})}]).factory("dataService",["$http","$q",function(n,t){function e(n){for(var r=null,t=i.length-1;t>=0;t--)if(i[t].id==n){r=i[t];break}return r}var i=[],r=!1,u=function(){return r},f=function(){var u=t.defer();return n.get("/api/v1/topics?includeReplies=true").then(function(n){angular.copy(n.data,i);r=!0;u.resolve()}).catch(function(n){console.log(n);u.reject(n)}),u.promise},o=function(r){var u=t.defer();return n.post("/api/v1/topics",r).then(function(n){var t=n.data;return i.splice(0,0,t),u.resolve(t)}).catch(function(n){return console.log(n),u.reject(n)}),u.promise},s=function(n){var i=t.defer(),r;return u()?(r=e(n),r?i.resolve(r):i.reject()):f().then(function(){var t=e(n);t?i.resolve(t):i.reject()}).catch(function(){i.reject()}),i.promise},h=function(i,r){var u=t.defer();return n.post("/api/v1/topics/"+i.id+"/replies",r).then(function(n){i.replies==null&&(i.replies=[]);i.replies.push(n.data);u.resolve(n.data)}).catch(function(n){u.reject(n)}),u.promise};return{topics:i,getTopics:f,addTopic:o,isReady:u,getTopicById:s,saveReply:h}}]).controller("topicsController",["$scope","$http","dataService",function(n,t,i){n.data=i;i.isReady()||(n.isBusy=!0,i.getTopics().then(function(){}).catch(function(n){console.log(n);alert("Something went wrong")}).finally(function(){n.isBusy=!1}))}]).controller("newTopicController",["$scope","$http","$window","dataService",function(n,t,i,r){n.newTopoic={};n.save=function(){r.addTopic(n.newTopic).then(function(){i.location="#/"}).catch(function(n){console.log(n);alert("Something went wrong saving the topic")}).finally(function(){})}}]).controller("singleTopicController",["$scope","dataService","$window","$routeParams",function(n,t,i,r){n.topic=null;n.newReply={};t.getTopicById(r.id).then(function(t){n.topic=t}).catch(function(){i.location="#/"});n.addReply=function(){t.saveReply(n.topic,n.newReply).then(function(){n.newReply.body=""}).catch(function(n){console.log(n);alert("Something went wrong")})}}]);